# A股自动化研报系统 - 设计文档

## 项目概述

构建一套面向 A 股市场的自动化研报生成系统，服务于个人投资决策。

### 核心定位
- **市场**：A 股
- **用户**：自己及朋友，未来可能公开
- **目标**：节省手动收集数据时间 + 提供信号
- **特点**：高度定制化，只包含需要的内容和视角

---

## 需求总结

### 已确认需求

| 维度 | 决策 |
|------|------|
| 自选股规模 | ~30 只，手动维护 |
| 板块分析 | 概念板块 + 行业板块 |
| 报告时机 | 盘前 + 盘后 |
| 输出形式 | TLDR（结论式）+ 数据展示 + 分析 |
| 输出格式 | PDF（本地），未来接飞书 |
| 运行环境 | 云端 |
| AI 辅助 | 需要（Claude/GPT） |

### 分析维度

| 模块 | Sprint 1 | 后续迭代 |
|------|----------|----------|
| 大盘数据 | ✅ | - |
| 外盘/期货 | ✅ | - |
| 政策面 | ✅ 数据罗列 | AI 解读 |
| 技术指标 | ✅ MACD/BOLL/RSI/量能 | 更多指标 |
| 资金因子 | ✅ 主力流入等 | - |
| 图形识别 | ❌ | ✅ AI 视觉（Phase 3-4） |
| 龙虎榜 | ❌ 仅标记 | ✅ 游资分析（Phase 2） |
| 财报分析 | ❌ | ✅ AI 分析（Phase 2-3） |
| 新闻聚合 | ✅ 基础 | AI 摘要 |

### 待调研事项

| 事项 | 状态 | 备选方案 |
|------|------|----------|
| 付费数据源 | 待调研 | Bloomberg / Wind / Choice / AKShare |
| 龙虎榜数据 | 待调研 | 同花顺 / 爬虫 / API |
| 爬虫工具 | Phase 2 | Browser Use 类 |

---

## 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              [触发层]                                        │
│                                                                             │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│   │  定时触发   │    │  手动触发   │    │  事件触发   │                    │
│   │  (盘前/盘后) │    │  (CLI/API)  │    │  (财报发布) │                    │
│   └──────┬──────┘    └──────┬──────┘    └──────┬──────┘                    │
│          └──────────────────┼──────────────────┘                           │
│                             ▼                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                         [调度编排层]                                         │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────┐          │
│   │                   Report Orchestrator                        │          │
│   │                                                              │          │
│   │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │          │
│   │  │  盘前报告    │  │  盘后报告    │  │  财报触发    │       │          │
│   │  │  Pre-Market  │  │  Post-Market │  │  Earnings    │       │          │
│   │  └──────────────┘  └──────────────┘  └──────────────┘       │          │
│   └─────────────────────────────────────────────────────────────┘          │
│                             ▼                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                         [数据采集层]                                         │
│                                                                             │
│   ┌────────────────┐  ┌────────────────┐  ┌────────────────┐               │
│   │  行情数据      │  │  资讯数据      │  │  特色数据      │               │
│   │                │  │                │  │                │               │
│   │ • 个股行情     │  │ • 政策新闻     │  │ • 龙虎榜       │               │
│   │ • 指数数据     │  │ • 公司公告     │  │ • 融资融券     │               │
│   │ • 外盘期货     │  │ • 财报日历     │  │ • 北向资金     │               │
│   │ • 板块数据     │  │                │  │ • 大宗交易     │               │
│   └───────┬────────┘  └───────┬────────┘  └───────┬────────┘               │
│           │                   │                   │                        │
│           │  ┌────────────────┴───────────────┐   │                        │
│           └──┤         Data Adapter           ├───┘                        │
│              │   (统一数据接口，便于切换源)    │                            │
│              └────────────────────────────────┘                            │
│                             ▼                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                         [数据处理层]                                         │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────┐          │
│   │                    Analysis Engine                           │          │
│   │                                                              │          │
│   │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │          │
│   │  │ 技术分析 │ │ 资金分析 │ │ 板块分析 │ │ 情绪分析 │       │          │
│   │  │          │ │          │ │          │ │          │       │          │
│   │  │• MACD    │ │• 主力流入│ │• 概念强弱│ │• 涨跌比  │       │          │
│   │  │• RSI     │ │• 北向资金│ │• 行业轮动│ │• 涨停数  │       │          │
│   │  │• BOLL    │ │• 融资余额│ │• 领涨股  │ │• 量能    │       │          │
│   │  │• 量价    │ │          │ │          │ │          │       │          │
│   │  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │          │
│   └─────────────────────────────────────────────────────────────┘          │
│                             ▼                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                         [AI 分析层] (Phase 2-4)                              │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────┐          │
│   │                   AI Analysis Module                         │          │
│   │                                                              │          │
│   │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │          │
│   │  │  TLDR 生成   │  │  图形识别    │  │  财报分析    │       │          │
│   │  │  (Sprint 1)  │  │  (Phase 3-4) │  │  (Phase 2-3) │       │          │
│   │  │              │  │              │  │              │       │          │
│   │  │  Claude API  │  │  Vision API  │  │  Prompt Eng  │       │          │
│   │  └──────────────┘  └──────────────┘  └──────────────┘       │          │
│   └─────────────────────────────────────────────────────────────┘          │
│                             ▼                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                         [报告生成层]                                         │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────┐          │
│   │                    Report Builder                            │          │
│   │                                                              │          │
│   │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │          │
│   │  │ 模板引擎 │→ │ Markdown │→ │   PDF    │→ │  推送    │    │          │
│   │  │ (Jinja2) │  │ 生成     │  │ 渲染     │  │ (飞书)   │    │          │
│   │  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │          │
│   │                                             ↑ Phase 2       │          │
│   └─────────────────────────────────────────────────────────────┘          │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                         [配置层 - 可定制化核心]                              │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────┐          │
│   │  config/                                                     │          │
│   │  ├── watchlist.yaml      # 自选股列表                        │          │
│   │  ├── sectors.yaml        # 关注板块配置                      │          │
│   │  ├── indicators.yaml     # 技术指标参数                      │          │
│   │  ├── report_template.yaml # 报告模块开关                     │          │
│   │  └── alerts.yaml         # 信号阈值配置                      │          │
│   └─────────────────────────────────────────────────────────────┘          │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                         [存储层]                                            │
│                                                                             │
│   ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                 │
│   │   SQLite     │    │    Redis     │    │  File Store  │                 │
│   │   历史数据   │    │   数据缓存   │    │   PDF 报告   │                 │
│   │   (可选)     │    │   (可选)     │    │              │                 │
│   └──────────────┘    └──────────────┘    └──────────────┘                 │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 可定制化设计

### 核心理念

系统采用**配置驱动**设计，所有可变部分通过 YAML 配置文件管理：

```yaml
# config/watchlist.yaml
watchlist:
  - code: "600519"
    name: "贵州茅台"
    priority: "high"      # high/medium/low
    notes: "核心持仓"
  - code: "000858"
    name: "五粮液"
    priority: "medium"
    notes: "观察仓"

# config/report_template.yaml
report:
  pre_market:
    enabled: true
    modules:
      - global_markets      # 外盘表现
      - futures            # 期货数据
      - policy_news        # 政策面
      - watchlist_preview  # 自选股关注点

  post_market:
    enabled: true
    modules:
      - market_summary     # 大盘总结
      - sector_analysis    # 板块分析
      - watchlist_analysis # 自选股分析（30只全扫描）
      - signals            # 今日信号
      - tomorrow_focus     # 明日关注

# config/indicators.yaml
technical:
  macd:
    fast: 12
    slow: 26
    signal: 9
  rsi:
    period: 14
    overbought: 70
    oversold: 30
  boll:
    period: 20
    std: 2

# config/alerts.yaml
signals:
  volume_surge:
    threshold: 2.0        # 量比 > 2
    enabled: true
  price_breakout:
    ma_periods: [5, 10, 20]
    enabled: true
  rsi_extreme:
    enabled: true
```

### 模块化扩展

```
modules/
├── collectors/           # 数据采集（可插拔）
│   ├── base.py          # 采集器接口
│   ├── akshare.py       # AKShare 实现
│   ├── tushare.py       # Tushare 实现
│   └── bloomberg.py     # Bloomberg 实现（待开发）
│
├── analyzers/           # 分析器（可插拔）
│   ├── base.py          # 分析器接口
│   ├── technical.py     # 技术分析
│   ├── capital_flow.py  # 资金分析
│   └── sector.py        # 板块分析
│
├── reporters/           # 报告模块（可插拔）
│   ├── base.py          # 报告模块接口
│   ├── market_summary.py
│   ├── watchlist.py
│   └── signals.py
│
└── exporters/           # 导出器（可插拔）
    ├── base.py
    ├── pdf.py
    ├── markdown.py
    └── lark.py          # 飞书（Phase 2）
```

---

## 报告结构设计

### 盘前报告 (Pre-Market)

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 A股盘前速递 | 2024-12-24
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【TLDR】
隔夜美股三大指数涨跌不一，纳指+0.3%。
A50 期货夜盘微涨 0.1%。
今日关注：XX 财报发布，YY 政策落地预期。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

一、隔夜外盘

| 指数 | 收盘 | 涨跌 |
|------|------|------|
| 道琼斯 | 37,xxx | -0.2% |
| 纳斯达克 | 15,xxx | +0.3% |
| 标普500 | 4,xxx | +0.1% |
| 恒生指数 | 17,xxx | -0.5% |
| 日经225 | 33,xxx | +0.2% |

二、期货市场

| 品种 | 价格 | 涨跌 |
|------|------|------|
| A50期货 | xxx | +0.1% |
| 原油 | $xx | -0.3% |
| 黄金 | $xxx | +0.2% |

三、今日关注

📅 事件：
• XX公司发布三季报
• YY行业政策发布会

📰 政策/新闻：
• [标题1]
• [标题2]

⚠️ 自选股提示：
• 贵州茅台：今日需关注...
• ...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 盘后报告 (Post-Market)

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 A股盘后复盘 | 2024-12-24
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【TLDR】
今日市场震荡，沪指 -0.3%，成交额 8500亿。
自选股：XX 放量突破，YY 回调至支撑位。
关注：ZZ 明日财报发布。
风险：AA 跌破关键支撑。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

一、大盘总结

| 指数 | 收盘 | 涨跌 | 成交额 |
|------|------|------|--------|
| 上证指数 | 3,xxx | -0.3% | 4200亿 |
| 深证成指 | 11,xxx | -0.5% | 4300亿 |
| 创业板指 | 2,xxx | -0.8% | - |

市场情绪：
• 涨跌比：1800:3200
• 涨停：45家 | 跌停：12家
• 量能：较昨日 -5%

二、板块分析

【强势板块】
| 板块 | 涨幅 | 领涨股 |
|------|------|--------|
| AI应用 | +2.3% | XX +10% |
| ... | ... | ... |

【弱势板块】
| 板块 | 跌幅 | 领跌股 |
|------|------|--------|
| 新能源 | -1.8% | YY -5% |
| ... | ... | ... |

三、自选股分析（30只）

┌─────────────────────────────────────────────┐
│ 600519 贵州茅台                              │
├─────────────────────────────────────────────┤
│ 收盘: 1750 | 涨跌: +1.2% | 量比: 1.5       │
│                                             │
│ 技术信号:                                   │
│ • RSI(14): 55 [中性]                        │
│ • MACD: 金叉后第3天                         │
│ • 站上5日/10日均线                          │
│                                             │
│ 资金信号:                                   │
│ • 主力净流入: +2.3亿                        │
│ • 北向资金: +0.5亿                          │
│                                             │
│ 小结: 放量站稳均线，短期偏多                 │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│ 000858 五粮液                                │
├─────────────────────────────────────────────┤
│ ...                                         │
└─────────────────────────────────────────────┘

... (其余28只)

四、今日信号

🔥 机会信号：
• 600519 贵州茅台：放量突破5日线
• ...

⚠️ 风险信号：
• XXXXXX：跌破20日均线，缩量
• ...

📊 异动提示：
• YYYYYY：尾盘拉升，量比3.2

五、明日关注

📅 重要事件：
• ZZ 三季报发布
• 央行公开市场操作

🎯 自选股关注点：
• 贵州茅台：关注能否站稳1750
• ...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ 以上分析仅供参考，不构成投资建议。
```

---

## 分阶段规划

### Phase 1: MVP (Sprint 1)

**目标**：跑通最小可用版本

```
Timeline: 2-3 周

Week 1: 基础搭建
├── Day 1-2: 项目结构 + 配置系统
├── Day 3-4: 数据采集层（先用 AKShare）
│   ├── 个股行情
│   ├── 指数数据
│   ├── 外盘期货
│   └── 板块数据
└── Day 5-7: 技术分析模块
    ├── MACD / RSI / BOLL
    └── 量价分析

Week 2: 报告生成
├── Day 1-3: 报告模板开发
│   ├── 盘前报告模板
│   └── 盘后报告模板
├── Day 4-5: PDF 生成
└── Day 6-7: TLDR 生成（Claude API）

Week 3: 自动化 + 调试
├── Day 1-2: 定时任务（云端部署）
├── Day 3-5: 端到端测试
└── Day 6-7: 优化调整
```

**Sprint 1 交付物**：
- [x] 30只自选股配置
- [x] 盘前报告（外盘+期货+政策标题）
- [x] 盘后报告（大盘+板块+30股分析+信号）
- [x] 技术指标：MACD/RSI/BOLL/量价
- [x] 资金指标：主力流入
- [x] TLDR 自动生成
- [x] PDF 输出
- [x] 定时运行（盘前 8:30，盘后 15:30）

**Sprint 1 不做**：
- ❌ 龙虎榜深度分析
- ❌ 财报分析
- ❌ 图形识别
- ❌ 飞书推送

---

### Phase 2: 数据增强

```
Timeline: 2-3 周

目标：
• 接入龙虎榜数据 + 游资席位识别
• Browser Use 爬虫探索
• 付费数据源调研/切换
• 飞书推送

交付物：
• 龙虎榜模块（游资/机构识别）
• 飞书机器人推送 PDF
• 数据源切换能力验证
```

---

### Phase 3: AI 深度分析

```
Timeline: 3-4 周

目标：
• AI 财报分析（Prompt 工程）
• 财报发布触发机制
• 政策面 AI 解读

交付物：
• 财报分析模块
• 政策解读模块
• 更智能的 TLDR
```

---

### Phase 4: 图形识别

```
Timeline: 3-4 周

目标：
• TradingView 图表采集
• AI 视觉图形识别
• 形态库（双顶/双底/三角形等）

交付物：
• 图形识别模块（2-3个典型形态）
• 周/月级别图形分析
• 量价配合判断
```

---

## 技术选型建议

| 层级 | Sprint 1 推荐 | 后续可选 |
|------|--------------|----------|
| 数据采集 | AKShare（免费） | Bloomberg / Wind / Tushare Pro |
| 数据处理 | pandas + ta-lib | polars（更快） |
| AI 分析 | Claude API | GPT-4 备选 |
| PDF 生成 | WeasyPrint / reportlab | - |
| 定时任务 | APScheduler | Celery（分布式） |
| 云部署 | 轻量云服务器 | Docker + K8s |
| 推送 | 本地 PDF | 飞书 Webhook |

---

## 数据源对比（待调研）

| 数据源 | 费用 | A股行情 | 龙虎榜 | 财报 | 稳定性 |
|--------|------|---------|--------|------|--------|
| AKShare | 免费 | ✅ | ✅ | ✅ | ⭐⭐⭐ |
| Tushare Pro | 200积分 | ✅ | ✅ | ✅ | ⭐⭐⭐⭐ |
| 东财 Choice | ~1万/年 | ✅ | ✅ | ✅ | ⭐⭐⭐⭐⭐ |
| Wind | ~3万/年 | ✅ | ✅ | ✅ | ⭐⭐⭐⭐⭐ |
| Bloomberg | 待确认 | ✅ | ❓ | ✅ | ⭐⭐⭐⭐⭐ |

**建议**：Sprint 1 先用 AKShare 跑通，验证流程后再决定是否付费。

---

## 项目结构

```
AI_Stock_Collection/
├── config/                      # 配置文件
│   ├── watchlist.yaml          # 自选股
│   ├── sectors.yaml            # 板块配置
│   ├── indicators.yaml         # 指标参数
│   ├── report.yaml             # 报告配置
│   └── secrets.yaml            # API Keys（gitignore）
│
├── src/
│   ├── collectors/             # 数据采集
│   │   ├── __init__.py
│   │   ├── base.py
│   │   ├── akshare_collector.py
│   │   ├── global_markets.py   # 外盘数据
│   │   └── news_collector.py   # 新闻采集
│   │
│   ├── analyzers/              # 数据分析
│   │   ├── __init__.py
│   │   ├── technical.py        # 技术分析
│   │   ├── capital_flow.py     # 资金分析
│   │   ├── sector.py           # 板块分析
│   │   └── signals.py          # 信号检测
│   │
│   ├── ai/                     # AI 模块
│   │   ├── __init__.py
│   │   ├── llm_client.py       # LLM 封装
│   │   ├── tldr_generator.py   # TLDR 生成
│   │   └── prompts/            # Prompt 模板
│   │
│   ├── reports/                # 报告生成
│   │   ├── __init__.py
│   │   ├── builder.py          # 报告构建器
│   │   ├── templates/          # Jinja2 模板
│   │   └── pdf_exporter.py     # PDF 导出
│   │
│   ├── scheduler/              # 调度
│   │   ├── __init__.py
│   │   └── cron.py
│   │
│   └── utils/                  # 工具函数
│       ├── __init__.py
│       ├── config_loader.py
│       └── logger.py
│
├── output/                     # 输出目录
│   ├── pre_market/
│   └── post_market/
│
├── tests/                      # 测试
├── requirements.txt
├── Dockerfile
└── README.md
```

---

## 下一步行动

### 立即可做
1. 确定 Sprint 1 的 30 只自选股
2. 注册 AKShare（或选定数据源）
3. 准备 Claude API Key

### 待调研
1. Bloomberg API 具体产品和费用
2. 龙虎榜数据获取方式
3. 云服务器选型

---

## 风险与应对

| 风险 | 影响 | 应对 |
|------|------|------|
| 免费数据源不稳定 | 报告生成失败 | 设计降级策略，核心数据多源备份 |
| AI 生成质量不稳定 | TLDR 不可用 | Prompt 迭代，设置质量检查 |
| 爬虫被封 | 数据缺失 | 降低频率，备选 API |
| 财报分析复杂 | 开发周期长 | 先用简单规则，逐步 AI 化 |
